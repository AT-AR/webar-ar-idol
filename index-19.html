
<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8" />
    <title>ARã‚¢ã‚¤ãƒ‰ãƒ«æ’®å½±ä½“é¨“</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
      body {
        margin: 0;
        overflow: hidden;
      }
      #arContainer {
        position: relative;
        width: 100vw;
        height: 100vh;
        background: black;
      }
      video {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        object-fit: cover; /* ã‚«ãƒ¡ãƒ©æ˜ åƒã‚’ç”»é¢å…¨ä½“ã«è¡¨ç¤º */
      }
      #characterImage {
        position: absolute;
        bottom: 10%;
        left: 50%;
        transform: translateX(-50%);
        max-width: 40vw;
        touch-action: none; /* ã‚¹ãƒãƒ›ã®ãƒ”ãƒ³ãƒã‚„ãƒ‰ãƒ©ãƒƒã‚°ã‚’è¨±å¯ */
      }
      #controls {
        position: absolute;
        bottom: 10px;
        left: 50%;
        transform: translateX(-50%);
        z-index: 10;
      }
      button {
        font-size: 1.2em;
        padding: 10px 20px;
        border: none;
        border-radius: 10px;
        background-color: #007bff;
        color: white;
        cursor: pointer;
      }
    </style>
  </head>
  <body>
    <div id="arContainer">
      <video id="camera" autoplay playsinline></video>
      <!-- ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ç”»åƒã‚’è¡¨ç¤ºï¼ˆå¾Œã§å·®ã—æ›¿ãˆå¯èƒ½ï¼‰ -->
      <img id="characterImage" src="cleaned_character.png" alt="ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼">
      <!-- æ’®å½±ãƒœã‚¿ãƒ³ã‚’è¡¨ç¤º -->
      <div id="controls">
        <button id="takePhoto">ğŸ“¸ æ’®å½±</button>
      </div>
    </div>

    <script>
      // ã‚«ãƒ¡ãƒ©ã®æ˜ åƒã‚’å–å¾—ã—ã¦èƒŒæ™¯ã«è¡¨ç¤º
      const camera = document.getElementById('camera');
      navigator.mediaDevices.getUserMedia({ video: { facingMode: 'environment' } })
        .then(stream => {
          camera.srcObject = stream;
        })
        .catch(error => {
          alert('ã‚«ãƒ¡ãƒ©ã«ã‚¢ã‚¯ã‚»ã‚¹ã§ãã¾ã›ã‚“ï¼š' + error.message);
        });

      // æ‹¡å¤§ç¸®å°å¯¾å¿œï¼ˆãƒ”ãƒ³ãƒã‚ºãƒ¼ãƒ ï¼‰
      const img = document.getElementById('characterImage');
      let scale = 1;
      let lastDist = null;

      img.addEventListener('touchmove', (e) => {
        if (e.touches.length === 2) {
          e.preventDefault();
          const dx = e.touches[0].clientX - e.touches[1].clientX;
          const dy = e.touches[0].clientY - e.touches[1].clientY;
          const dist = Math.sqrt(dx * dx + dy * dy);
          if (lastDist !== null) {
            const delta = dist - lastDist;
            scale += delta * 0.005;
            scale = Math.min(Math.max(scale, 0.5), 3.0); // æ‹¡å¤§ãƒ»ç¸®å°ã®åˆ¶é™
            img.style.transform = `translateX(-50%) scale(${scale})`;
          }
          lastDist = dist;
        }
      });
      img.addEventListener('touchend', () => {
        lastDist = null;
      });

      // æ’®å½±å‡¦ç†ï¼šç¾åœ¨ã®ç”»é¢ã‚’canvasã«æç”»ã—ç”»åƒä¿å­˜ï¼ˆç°¡æ˜“ç‰ˆï¼‰
      document.getElementById('takePhoto').addEventListener('click', () => {
        const canvas = document.createElement('canvas');
        const w = window.innerWidth;
        const h = window.innerHeight;
        canvas.width = w;
        canvas.height = h;
        const ctx = canvas.getContext('2d');
        // ã‚«ãƒ¡ãƒ©æ˜ åƒã‚’èƒŒæ™¯ã¨ã—ã¦æç”»
        ctx.drawImage(camera, 0, 0, w, h);
        // ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ç”»åƒã®ç¾åœ¨ã®ä½ç½®ã¨æ‹¡å¤§ç‡ã§æç”»
        const rect = img.getBoundingClientRect();
        const scaleFactor = scale;
        const imgWidth = img.naturalWidth * scaleFactor;
        const imgHeight = img.naturalHeight * scaleFactor;
        const centerX = w / 2 - imgWidth / 2;
        const y = rect.top;
        ctx.drawImage(img, centerX, y, imgWidth, imgHeight);

        // ä¿å­˜
        const link = document.createElement('a');
        link.download = 'photo.png';
        link.href = canvas.toDataURL('image/png');
        link.click();
      });
    </script>
  </body>
</html>
